---
import Header from '@components/header.astro';
import Default from '@layouts/default.astro';

type WishlistItem = {
  title: string;
  description: string;
  links?: { title: string; url: string }[];
};

type WishlistSection = {
  section: string;
  items: WishlistItem[];
};

type WishlistEntry = WishlistItem | WishlistSection;

const isSection = (entry: WishlistEntry): entry is WishlistSection => {
  return 'section' in entry;
};

const wishlist: WishlistEntry[] = [
  {
    title: "Standalone Item Example",
    description: "This is a standalone item without a section",
    links: [{ title: "Example Link", url: "https://example.com" }]
  },
  {
    section: "Electronics",
    items: [
      {
        title: "Mechanical Keyboard",
        description: "A nice mechanical keyboard with Cherry MX switches",
        links: [
          { title: "Amazon", url: "https://amazon.com" },
          { title: "Manufacturer", url: "https://example.com" }
        ]
      },
      {
        title: "USB-C Hub",
        description: "Multi-port hub for laptop connectivity"
      }
    ]
  },
  {
    section: "Books",
    items: [
      {
        title: "Design Patterns",
        description: "Classic software engineering book"
      },
      {
        title: "The Pragmatic Programmer",
        description: "Tips and techniques for modern software development",
        links: [{ title: "Bookshop", url: "https://bookshop.org" }]
      }
    ]
  },
  {
    title: "Another Standalone Item",
    description: "Items can appear anywhere in the list, not just at the top"
  }
];
---

<Default>
  <Header />
  <section>
    <h2>Wishlist</h2>
    <p>Things and stuff</p>
  </section>
  <main>
    {
      wishlist.filter(isSection).map((entry) => (
        <section class="wishlist-section">
          <h3>{entry.section}</h3>
          <ul class="wishlist">
            {entry.items.map((item) => (
              <li class="wishlist-item">
                <strong>{item.title}</strong>
                <p>{item.description}</p>
                {item.links && item.links.length > 0 && (
                  <ul class="wishlist-links">
                    {item.links.map((link) => (
                      <li>
                        <a href={link.url}>{link.title}</a>
                      </li>
                    ))}
                  </ul>
                )}
              </li>
            ))}
          </ul>
        </section>
      ))
    }
    {
      (() => {
        const miscItems = wishlist.filter((entry): entry is WishlistItem => !isSection(entry));
        return miscItems.length > 0 && (
          <section class="wishlist-section">
            <h3>Misc</h3>
            <ul class="wishlist">
              {miscItems.map((item) => (
                <li class="wishlist-item">
                  <strong>{item.title}</strong>
                  <p>{item.description}</p>
                  {item.links && item.links.length > 0 && (
                    <ul class="wishlist-links">
                      {item.links.map((link) => (
                        <li>
                          <a href={link.url}>{link.title}</a>
                        </li>
                      ))}
                    </ul>
                  )}
                </li>
              ))}
            </ul>
          </section>
        );
      })()
    }
  </main>
</Default>

<style>
  h2 {
    margin-block-end: 8px;
  }

  .wishlist-section {
    margin-block-start: 24px;
  }

  .wishlist-section h3 {
    margin-block-end: 12px;
    font-size: 1.4em;
    font-weight: 600;
    opacity: 0.9;
  }

  .wishlist {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .wishlist-section {
    padding-block-end: 24px;
    border-bottom: 1px solid color-mix(in srgb, currentColor 20%, transparent);
  }

  .wishlist-section:last-child {
    border-bottom: none;
    padding-block-end: 0;
  }

  .wishlist-item {
    margin-block-end: 16px;
  }

  .wishlist-item:last-child {
    margin-block-end: 0;
  }

  .wishlist-item strong {
    display: block;
    font-weight: 500;
  }

  .wishlist-item p {
    margin-block-start: 4px;
    opacity: 0.8;
    font-size: 0.95em;
  }

  .wishlist-links {
    list-style: none;
    padding: 0;
    margin-block-start: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 4px 12px;
    font-size: 0.9em;
  }
</style>
